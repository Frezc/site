<!--
title: 某部门人员星座分布
resource:
  jsFiles:
    - ${url.dataSet}
    - ${url.jquery}
plotDescription: 约一半同学喜欢海岛休闲游，20% 的同学万年不变的选择了千岛湖，其次较多的是柬埔寨，呼伦贝尔选择较少是因为季节不对。距离较远的苏梅岛和塞班岛，相对来说不受欢迎。
plotUsage: 数据来源：demo数据
filter: 标签,label样式
tags: label样式
recommend: true
subCat: 基础饼图
-->
<style>
    .g2-guide-html {
        width: 100px;
        height: 100px;
        vertical-align: middle;
        text-align: center;
        opacity: 0;
    }

    .g2-guide-html .title {
        font-size: 12px;
        color: #8c8c8c;
        font-weight: 300;
    }

    .g2-guide-html .value {
        font-size: 30px;
        color: #000;
        font-weight: bold;
    }
</style>
<script>
    const data = [
        { type: '评估中', percent: 0.23 },
        { type: '设计中', percent: 0.28 },
        { type: '正在开发', percent: 0.30 },
        { type: '已上线', percent: 0.19 }
    ];
    const sum = 500;
    const ds = new DataSet();
    const dv = ds.createView().source(data);
    dv.transform({
        type: 'map',
        callback(row) {
            row.value = parseInt(sum * row.percent);
            return row;
        }
    });
    const chart = new G2.Chart({
        container: 'mountNode',
        forceFit: true,
        height: window.innerHeight,
        padding: 'auto'
    });
    chart.source(dv);
    chart.tooltip(false);
    chart.legend({
        position: 'right-center',
        offsetX: -100
    });
    chart.coord('theta', {
        radius: 0.75,
        innerRadius: 0.6
    });
    chart.intervalStack().position('percent').color('type', ['#0a7aca', '#0a9afe', '#4cb9ff', '#8ed1ff']).opacity(1).label('percent', {
        offset: -10,
        textStyle: {
            fill: 'white',
            fontSize: 12,
            shadowBlur: 2,
            shadowColor: 'rgba(0, 0, 0, .45)'
        },
        formatter: (text, item) => {
            return String(parseInt(item.point.percent * 100)) + '%';
        }
    });
    chart.guide().html({
        position: ['50%', '50%'],
        html: '<div class="g2-guide-html"><p class="title">项目总计</p><p class="value"></p></div>'
    });
    chart.on('interval:mouseenter', function (ev) {
        const data = ev.data._origin;
        $(".g2-guide-html").css('opacity', 1);
        $(".g2-guide-html .value").text(data.value);
    });

    chart.on('interval:mouseleave', function () {
        $(".g2-guide-html").css('opacity', 0);
        $(".g2-guide-html .value").text('');
    });
    chart.render();
</script>